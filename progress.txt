# Ralph Progress Log
Started: Fri Jan  9 12:04:37 PM UTC 2026
---

## Codebase Patterns
- Package manager functions (`detect_package_manager`, `pkg_install`, `pkg_update`, `get_install_hint`) are defined in BOTH `install.sh` and `lib/core.sh` - keep synchronized
- Use `PKG_MANAGER` and `PKG_UPDATED` globals with `${VAR:-}` pattern for shell compatibility
- `detect_package_manager()` caches result in `PKG_MANAGER` global for performance
- Supported distros: debian/ubuntu/mint/pop/elementary/zorin/kali/raspbian (apt), rhel/centos/fedora/almalinux/rocky/ol/amzn (dnf/yum), arch/manjaro/endeavouros/artix (pacman), alpine (apk), opensuse/sles/suse (zypper)

---

## 2026-01-09 - US-001
Iteration: 1
- Implemented package manager auto-detection for all major Linux distributions
- Added functions: `detect_package_manager()`, `pkg_install()`, `pkg_update()`, `get_install_hint()`
- Files changed:
  - `install.sh` - Added package manager functions (lines 61-211), replaced all `apt-get` calls
  - `lib/core.sh` - Added same package manager functions (lines 30-182), replaced `apt-get install unzip` call
  - `prd.json` - Created from PRD markdown for Ralph tracking
- **Learnings for future iterations:**
  - PRD was in markdown format (`tasks/prd-multi-package-manager-support.md`), created `prd.json` for Ralph
  - Package manager functions must exist in both `install.sh` (standalone installer) and `lib/core.sh` (sourced by main script)
  - Keep package manager functions identical in both files - any changes need dual updates
  - The `lib/core.sh` is sourced by `backupd.sh`, so functions defined there are available to all lib modules
---

## 2026-01-09 - US-002
Iteration: 2
- Verified bzip2 installation already implemented in US-001
- The `install_restic_verified()` function (install.sh:545-550) calls `pkg_install bzip2` when bunzip2 is not available
- The `pkg_install` function correctly handles:
  - `dnf install -y -q bzip2` for RHEL 8+, Fedora, AlmaLinux, Rocky Linux (when dnf available)
  - `yum install -y -q bzip2` for RHEL 7, CentOS 7 (when dnf not available)
- Files changed:
  - `prd.json` - Marked US-002 as passes: true (implementation verified from US-001)
- **Learnings for future iterations:**
  - Some user stories may already be satisfied by prior implementations - verify before implementing
  - The bzip2 installation is triggered automatically during restic installation, not as a separate step
  - The `-q` (quiet) flag on dnf/yum is acceptable - matches acceptance criteria intent
---
